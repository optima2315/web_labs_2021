<!DOCTYPE html>
<html>

<head>
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Import materialize.css-->
  <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />
  <link type="text/css" rel="stylesheet" href="css/style.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!--Optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lab 1 Web 2021</title>
</head>

    
<body id="home" class="scrollspy">
  <header class="main-header">
    <div class="primary-overlay">
      <div class="navbar-fixed">
        <nav class="transparent">
          <div class="container">
            <div class="nav-wrapper">
              <a href="#home" class="brand-logo">Labs</a>
              <a href="#" data-activates="mobile-nav" class="button-collapse">
                <i class="material-icons">menu</i>
              </a>
              <ul class="right hide-on-med-and-down">
                <li>
                  <a href="#home">Home</a>
                </li>
                <li>
                  <a href="#about">About</a>
                </li>
                <li>
                  <a href="#contact">Contact</a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </div>
      <!-- Side nav -->
      <ul class="side-nav" id="mobile-nav">
        <h4 class="black-text center">Labs</h4>
        <li>
          <a href="#home">Home</a>
        </li>
        <li>
          <a href="#about">About</a>
        </li>
        <li>
          <a href="#contact">Contact</a>
        </li>
      </ul>
     
    </div>
  </header>

<div class="showcase container">
        <div class="row">
          <div class="col s12 main-text" style="opacity: 1;">
            <a href="#contact" class="white-text">
              <i class="material-icons medium scroll-icon">arrow_drop_down_circle</i>
            </a>
          </div>
        </div>
      </div>

  <!-- Form -->
  <section id="contact" class="section section-contact center scrollspy">
      <form id='form' action="javascript:Validate();">
    <div class="container">
      <div class="row">
        <div class="col s12 m6 offset-m6">
          <div id='showData' class="card-panel z-depth-5">
            <h4>Suggest your clothes</h4>
            <div class="input-field">
                <!-- placeholders for inputs and autofocus-->
              <input type="text" autofocus id="surname" placeholder="Surname">
            </div>
            <div class="input-field">
              <input type="email" id="email" placeholder="Email">
            </div>
            <div class="input-field">
              <input type="text" id="phone" placeholder="Phone Number" pattern= "^[ 0-9]+$" maxlength="13">
            </div>
              <!-- Textarea -->
            <div class="input-field">
              <textarea class="materialize-textarea" id="comment" placeholder="Comment"></textarea>
            </div>
              <br>
              <h5>Describe your clothes</h5>
              <!-- Inputs for clothes with required-->
            <div class="input-field">
              <input type="text" id="name" required placeholder="Name">
            </div>
              <div class="input-field">
              <input type="text" id="description" placeholder="Description">
            </div>
            <!-- Inputs for clothes with max and min-->
            <div class="input-field">
              <input type="number" min="0" max="100" id="lenght" placeholder="Lenght in %">
            </div>
            <div class="input-field">
              <input type="number" id="waterproof" min="0" max="100" required placeholder="Waterproof in %">
            </div>
            <div class="input-field">
              <input type="number" id="windproof" min="0" max="100" required placeholder="Windproof in %">
            </div>
            <div class="input-field">
              <input type="number" id="comfT" min="-40" max="40" required placeholder="Comfort temperature for wearing">
            </div>
              <button type="submit" value="Submit" id='submit' class="btn blue-grey">Submit</button>
              <br>
              <!-- hidden as an example-->
              <h5 id="thank" hidden>Thank you for your suggestion! We will consider this item.</h5>
          </div>
        </div>
      </div>
    </div>
          </form>
    <br>
    <div>
      <h4>Show stored clothes?..</h4>
      <form action="javascript:ShowChosenTable();" ><input type="radio" id="up" name="cloth" value="up" checked>
              <label for="up">Up clothes</label><br>
              <input type="radio" id="down" name="cloth" value="down">
              <label for="down">Down clothes</label><br><input type="submit" value="Show">
      </form>
    </div>
  </section>

  <!-- Footer -->
  <footer class="page-footer blue-grey darken-1">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5>Lab 1</h5>
          <p>Rubanik T.</p>
          <p>356 group</p>
        </div>
        <div class="col l4 offset-l2 s12">
          <h5 class="white-text">Menu</h5>
          <ul>
            <li><a class="grey-text text-ligten-3" href="#home"></a>Home</li>
            <li><a class="grey-text text-ligten-3" href="#about"></a>About</li>
            <li><a class="grey-text text-ligten-3" href="#contact"></a>Contact</li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright blue-grey darken-4">
      <div class="container">
        2021
        <a class="grey-text text-lighten-4 right" href="#"><i class="material-icons left">keyboard_arrow_up</i>Back To Top</a>
      </div>
    </div>
  </footer>
</body>
    
<script>
        function Validate()
    {
        //Ограничение на единовременную отправку предложений (не более 3)
        if(sessionStorage.length>=3)
            {
                alert('Sorry, only 3 items per session.'); 
                return;
            }
        
       //Валидация средствами JS с уведомлением
        if (document.getElementById('email').value.length<4)
            { alert('Please, fill the field Email.');
             document.getElementById('email').focus();
             return;}
        
        //Сохранение данных для дальнейшего отображения/отправки
       var fields = ['surname','email','phone','comment',
                     'name','description','lenght','waterproof','windproof','comfT',];
        
        var clothItem = new Object();
        fields.forEach(function(fieldName,i,fields)
        {
            var val=document.getElementById(fieldName).value;
            if(val.length>=1)
                { clothItem[fieldName]=val;}
            else {clothItem[fieldName]='empty'; }
        });
        //Т.к. в остальном приложении используется не температура, а clo, пересчитаем показатель:
        
        var clo = (31-clothItem['comfT'])/0.155/150/2;
        //немного модифицированная формула, т.к. обычно оценке подвергается весь коплект одежды, а не один элемент
                   
        delete clothItem.comfT;
        clothItem['clo']=clo;
        
        //Сохранение данных (в дальнейших лр уйдёт в cookie)
        sessionStorage.setItem(sessionStorage.length,JSON.stringify(clothItem));
        
        //Заменим форму на последние введённые данные, чтобы продемонстрировать юзеру
        var show = document.getElementById('showData');
                    show.innerHTML='';
                var data=JSON.parse(sessionStorage.getItem(sessionStorage.length-1));
        
                var str = "<div class='row'><div class='col s12 m6'><h4>Your data:</h4></div><div class='col s12 m5 offset-m1'>";
                str +="<br><ul class='collection with-header z-depth-4'> <li class='collection-header'><h5>Clothes</h5></li>";
                Object.keys(data).forEach(function (key) 
                {
                    if (data[key]!='empty')
                    { str +="<li class='collection-item'><i class='material-icons left'>check</i>"+key+": "+data[key]+"</li>";}
                });
    
                str +="</ul></div></div>";
                show.innerHTML=str;
      alert('Your suggestion was saved.');
        return;
    }


    function ShowChosenTable()
    {
      var selectedTable = '';
      if (document.getElementById('down').checked) {selectedTable='downclothes';}
      else {selectedTable='upclothes';}
      var table;
      $.ajax
      (
              {
                url: 'showtable.php',
                method: "post",
                data: {"table": selectedTable},
                success: function (data) {
                  table = jQuery.parseJSON(data);
                  //Заменим форму на таблицу из БД
                  var show = document.getElementById('showData');
                  show.innerHTML='';
                  var tbl = "<h4>"+selectedTable+"</h4>";
                  tbl+='<div><table> <tr style=\"font: caption; font-style: oblique"><td>Name</td><td>Description</td><td>Waterproof, %</td><td>Windproof, %</td><td>Clo</td></tr>';
                         
                  table.forEach(function(row)
                  {
                    tbl+='<tr><td>'+row.name+'</td><td>'+row.description+'</td><td>'+row.waterproof+'</td><td>'+row.windproof+'</td><td>'+row.clo+'</td></tr>';
                  })

                  tbl+='</table></div>';
                  show.innerHTML=tbl;
                  console.log(table[0].name);
                },
                error: function (data) {
                  alert('Sorry, error while connecting with DB, try again later.');
                  console.log(data);
                }
              }
      )

      return;
    }
    </script>
    
</html>
